version: 6.0.23
session: 68acf25541189ac907c336fe
steps:
  - prompt: Download and start playwright codegen
    commands:
      - command: exec
        lang: pwsh
        timeout: 480000
        code: |
          echo "Step 1: Setting up npm environment"
          # Create npm directory if it doesn't exist
          $npmDir = "$env:APPDATA\npm"
          if (!(Test-Path $npmDir)) {
              New-Item -ItemType Directory -Force -Path $npmDir
              echo "Created npm directory: $npmDir"
          }

          echo "Step 2: Installing Node.js and npm (if needed)"
          # Check if node is available, if not try to install it
          try {
              node --version
              npm --version
          } catch {
              echo "Node.js/npm not found, attempting to install..."
              # Try to install Node.js via winget if available
              try {
                  winget install OpenJS.NodeJS
              } catch {
                  echo "Could not install Node.js automatically. Please install Node.js manually."
                  exit 1
              }
          }

          echo "Step 3: Installing Playwright dependencies"
          npm install -g playwright
          npx playwright install --with-deps chromium

          echo "Step 4: Generating Playwright script (non-blocking)"
            $desktopPath = [Environment]::GetFolderPath("Desktop")
            $outputFile = Join-Path $desktopPath "pw-test.spec.js"
            Start-Process cmd.exe -ArgumentList "/c npx playwright codegen --target playwright-test -o `"$outputFile`" https://airbnb.com"
          echo "Step 5: Completed"
          exit
