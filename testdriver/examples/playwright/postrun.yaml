version: 6.0.23
session: 68acf25541189ac907c336fe
steps:
  - prompt: Upload test to Airtable
    commands:
      - command: exec
        lang: pwsh
        timeout: 30000
        code: |
          # Find the test file
          $testFile = Join-Path ([Environment]::GetFolderPath("Desktop")) "pw-test.spec.js"
          
          if (!(Test-Path $testFile)) {
              Write-Host "No test file found"
              exit 0
          }
          
          # Read file content
          $content = Get-Content -Path $testFile -Raw
          $testName = [System.IO.Path]::GetFileNameWithoutExtension("${TD_THIS_FILE}")
          
          # Upload to Airtable
          $data = @{
              records = @(@{
                  fields = @{
                      "Name" = $testName
                      "Content" = $content
                      "Created" = (Get-Date -Format "yyyy-MM-dd HH:mm:ss")
                  }
              })
          } | ConvertTo-Json -Depth 3
          
          $headers = @{
              "Authorization" = "Bearer ${TD_AIRTABLE_TOKEN}"
              "Content-Type" = "application/json"
          }
          
          try {
              $response = Invoke-RestMethod -Uri "https://api.airtable.com/v0/${TD_AIRTABLE_BASE_ID}/${TD_AIRTABLE_TABLE_NAME}" -Method Post -Headers $headers -Body $data
              Write-Host "✅ Uploaded: $($response.records[0].id)"
          } catch {
              Write-Host "❌ Upload failed: $($_.Exception.Message)"
          }
          